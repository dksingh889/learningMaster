{% extends "admin/base.html" %}

{% block title %}SEO Posts - Admin{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2>All Posts (SEO Optimized)</h2>
    <a href="{{ url_for('admin_seo_new_post') }}" class="btn btn-primary">+ New SEO Post</a>
</div>

<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Status</th>
            <th>SEO Score</th>
            <th>Published</th>
            <th>Updated</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for post in posts.items %}
        <tr>
            <td>
                <a href="{{ url_for('admin_seo_post_detail', post_id=post.id) }}" style="color: #2563eb; text-decoration: none;">
                    {{ post.title }}
                </a>
            </td>
            <td>{{ post.author }}</td>
            <td>
                <span style="padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; 
                    {% if post.status == 'published' %}background: #d1fae5; color: #065f46;
                    {% elif post.status == 'draft' %}background: #fef3c7; color: #92400e;
                    {% else %}background: #e5e7eb; color: #374151;{% endif %}">
                    {{ post.status|title }}
                </span>
            </td>
            <td>
                {% if post.id in seo_scores %}
                    {% set score = seo_scores[post.id] %}
                    <span style="padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; font-weight: 600;
                        {% if score >= 80 %}background: #d1fae5; color: #065f46;
                        {% elif score >= 60 %}background: #fef3c7; color: #92400e;
                        {% else %}background: #fee2e2; color: #991b1b;{% endif %}">
                        {{ score }}/100
                    </span>
                {% else %}
                    <span style="color: #9ca3af;">N/A</span>
                {% endif %}
            </td>
            <td>{% if post.published_date %}{{ post.published_date.strftime('%Y-%m-%d') }}{% else %}N/A{% endif %}</td>
            <td>{% if post.updated_at %}{{ post.updated_at.strftime('%Y-%m-%d') }}{% else %}N/A{% endif %}</td>
            <td>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    {% if post.status == 'draft' %}
                    <form method="POST" action="{{ url_for('admin_seo_toggle_post_status', post_id=post.id) }}" style="display: inline;">
                        <button type="submit" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.85rem; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">üì¢ Publish</button>
                    </form>
                    {% else %}
                    <form method="POST" action="{{ url_for('admin_seo_toggle_post_status', post_id=post.id) }}" style="display: inline;">
                        <button type="submit" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.85rem; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer;">üìù Unpublish</button>
                    </form>
                    {% endif %}
                    <a href="{{ url_for('admin_seo_edit_post', post_id=post.id) }}" class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">Edit</a>
                    <a href="{{ url_for('admin_seo_post_detail', post_id=post.id) }}" class="btn btn-secondary" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">SEO Analysis</a>
                    <a href="{{ url_for('post_detail', slug=post.slug) }}" target="_blank" class="btn btn-secondary" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">View</a>
                    <form method="POST" action="{{ url_for('admin_seo_delete_post', post_id=post.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.');">
                        <button type="submit" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.85rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
                    </form>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if posts.pages > 1 %}
<div style="margin-top: 2rem; text-align: center;">
    {% if posts.has_prev %}
        <a href="{{ url_for('admin_seo_posts', page=posts.prev_num) }}" class="btn btn-secondary">Previous</a>
    {% endif %}
    <span style="margin: 0 1rem;">Page {{ posts.page }} of {{ posts.pages }}</span>
    {% if posts.has_next %}
        <a href="{{ url_for('admin_seo_posts', page=posts.next_num) }}" class="btn btn-secondary">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}

